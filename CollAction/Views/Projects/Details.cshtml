@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.AspNetCore.Http.Features

@inject IViewLocalizer Localizer

@model CollAction.Models.DisplayProjectViewModel

@{
    var consentFeature = Context.Features.Get<ITrackingConsentFeature>();
    var canTrack = consentFeature.CanTrack;

    ViewData["Title"] = @Model.Project.Name + " Details";
}

@section Meta {
    <meta name="description" content="@Model.Project.Description" />
    <meta property="og:url" content="" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="@Model.Project.Name" />
    <meta property="og:description" content="@Model.Project.Description" />
    <meta property="og:image" content="@Model.BannerImagePath" />
}

<div id="project-details">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 banner" id="project-background" style="background-image:url('@Model.BannerImagePath')">
            </div>
        </div>
    </div> 
    <div class="container">
        @{
            string disableCommit = "";
            string commitText = "Take Part";
            if (!Model.Project.IsActive)
            {
                disableCommit = "disable-commit";
            }
            if (Model.ExternalStatus == ProjectExternalStatus.ComingSoon)
            {
                commitText = "Coming soon";
            }
            else if (Model.ExternalStatus ==  ProjectExternalStatus.Closed)
            {
                commitText = "Project is finished";
            }
        }
        <div class="row" id="project-details-row">
            <div class="col-md-6 col-md-push-6 col-xs-12">
                <div id="project-info-card">
                    <div id="project-category" style="background-color: #@Html.DisplayFor(model => model.Project.Category.ColorHex)">
                        @Html.DisplayFor(model => model.Project.Category.Name)
                    </div>
                    <h1>@Html.DisplayFor(model => model.Project.Name)</h1>
                    <div id="project-progress">
                        <span id="project-pie-chart" data-percent-complete="@Math.Min(100, Model.Progress)" />
                        <h2>@Html.DisplayFor(model => model.Progress)%</h2>
                    </div>

                    <div id="more-info">
                        <p>@Html.DisplayFor(model => model.Project.Proposal)</p>
                    </div>

                    <hr />

                    <div id="project-location">
                        <p>
                            @if (Model.Project.Location != null)
                            {
                                <i class="fa fa-map-marker"></i>
                                @Html.DisplayFor(model => model.Project.Location.Name)
                            }
                        </p>
                    </div>

                    <div id="project-participation">
                        <ul>
                            <li>
                                <h4>@Html.DisplayFor(model => model.RemainingTimeUserFriendly)</h4>
                                <p>To go</p>
                            </li>

                            <li>
                                <h4>@Html.DisplayFor(model => model.Project.Target)</h4>
                                <p>Target</p>
                            </li>

                            <li>
                                <h4>@Html.DisplayFor(model => model.Participants)</h4>
                                <p>Participants</p>
                            </li>
                        </ul>
                    </div>
                    @if (Model.IsUserCommitted)
                    {
                        <h4 class="participating">You're participating!</h4>
                    }
                    else
                    {
                        <a class="take-part-button @disableCommit" asp-action="Commit" asp-route-id="@Model.Project.Id">@commitText</a>
                    }
                </div>
            </div>
            <div class="col-md-6 col-md-pull-6 col-xs-12">
                <div class="row" id="project-starter-row">
                    <div class="col-md-6 col-md-push-6 col-xs-12">
                        @if (canTrack)
                        {
                            <h4>Share this project</h4>
                            <div id="project-details-share-buttons"></div>
                        }
                    </div>
                    <div class="col-md-6 col-md-pull-6 col-xs-12">
                        <div class="row">
                            @if (!String.IsNullOrEmpty(Model.Project.Owner?.FirstName) && !String.IsNullOrEmpty(Model.Project.Owner?.LastName))
                            {
                                <div class="col-xs-3 col-md-12">
                                    <div id="project-starter-avatar"></div>
                                </div>
                                <div class="col-xs-9 col-md-12" id="project-starter-name">
                                    <h3>Project Starter</h3>
                                    <p>@Model.Project.Owner.FirstName @Model.Project.Owner.LastName</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <hr class="hidden-sm hidden-xs" />
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12 col-md-4 description-tags-container">
                <div class="project-short-description">
                    <h3>Short description:</h3>
                    <div>@Html.Raw(Model.Project.Description)</div>
                </div>
                <div class="project-dates">
                    <h3>Start date:<h3> 
                    <span>@Html.DisplayFor(model => model.Start)</span>                    
                    <h3>End date:</h3>
                    <span>@Html.DisplayFor(model => model.End)</span>
                </div>
                @if (Model.Project.Tags.Count > 0)
                {
                    <div class="project-hashtags">
                        <h3>Hashtags: </h3>
                        <p>
                            @foreach (var t in Model.Project.Tags)
                            {
                                <span>@Html.DisplayFor(m => t.Tag.Name)</span>
                            }
                       </p>
                    </div>
                }
            </div>
            <div class="col-xs-12 col-md-7 col-md-offset-1">
                <div class="goal-proposal-container">
                    <div class="project-goal">
                        <h3>Goal / impact</h3>
                        <div>@Html.Raw(Model.Project.Goal)</div>
                    </div>
                    <div class="project-green-proposal">
                        <p><q>@Html.DisplayFor(model => model.Project.Proposal)</q></p>
                    </div>
                </div>

                @if (!String.IsNullOrEmpty(Model.Project.CreatorComments))
                {
                    <hr class="hidden-sm hidden-xs" />
                    <div class="comments-container">
                        <div class="project-comments">
                            <h3>Other comments</h3>
                            <div>@Html.Raw(Model.Project.CreatorComments)</div>
                        </div>
                    </div>
                }
            </div>
        </div>

        @if (Model.Project.DescriptiveImage != null)
        {            
            <div class="row" id="project-image">
                <div class="hidden-xs hidden-sm col-md-3">
                    <div class="image-description">
                        <p>@Html.DisplayFor(model => model.Project.DescriptiveImage.Description)</p>
                    </div>
                </div>
                <div class="col-xs-12 col-md-9">
                    <img src="@Model.Project.DescriptiveImage.Filepath" class="pull-right"></img>
                </div>
                <div class="col-xs-12 hidden-md hidden-lg">
                    <div class="image-description">
                        <p>@Html.DisplayFor(model => model.Project.DescriptiveImage.Description)</p>
                    </div>
                </div>
            </div>
        }

        @if (canTrack && Model.HasDescriptionVideo)
        {
            <div class="row">
                <div class="col-xs-12 col-md-8 col-md-offset-4 video-container">
                    <hr class="hidden-sm hidden-xs" />
                    <div class="embed-responsive embed-responsive-16by9 ytembed">
                        <iframe id="ytplayer" type="text/html"
                                src="@Model.DescriptionVideoYouTubeEmbedLink"></iframe>
                    </div>
                </div>
            </div>
        }

        <div class="row">
            <div class="col-xs-12 col-md-4 col-md-offset-8 bottom-take-part">
                @if (Model.IsUserCommitted)
                {
                    <h4 class="participating">You're participating!</h4>
                }
                else
                {
                    <a class="take-part-button @disableCommit" asp-action="Commit" asp-route-id="@Model.Project.Id">@commitText</a>
                }
            </div>
        </div>

    </div> 
    
    @if (canTrack)
    {
        <div id="project-share">
            <div class="container">
                <div class="row">
                    <div id="project-details-share-buttons-row"></div>
                </div> 
            </div> 
        </div>
    }
</div> 

